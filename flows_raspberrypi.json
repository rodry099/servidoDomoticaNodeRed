[{"id":"d7ce74a.43e7388","type":"tab","label":"RiegoAuto","disabled":false,"info":"temporizar riego\n"},{"id":"f25737d2.a56978","type":"tab","label":"ControlRiego","disabled":false,"info":""},{"id":"d790f34d.d1733","type":"tab","label":"Home","disabled":false,"info":"pantalla principal con informacion \nde las actividades"},{"id":"7deeec4c.206c84","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"c88d6057.281f6","type":"tab","label":"termostato","disabled":false,"info":""},{"id":"e1b7f5f3.0b6ab8","type":"ui_tab","z":"","name":"Riego Automatico","icon":"wi-wu-chancetstorms","order":2,"disabled":false,"hidden":false},{"id":"617de4b8.ce394c","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Control Domotico","hideToolbar":"false","allowSwipe":"true","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":28,"sy":28,"gx":17,"gy":17,"cx":6,"cy":6,"px":6,"py":6}}},{"id":"3e69dea1.d0ec72","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"2393d6f0.2f06da","type":"ui_spacer","name":"spacer","group":"b6d52961.196668","order":3,"width":"12","height":1},{"id":"75e02395.761c8c","type":"ui_spacer","name":"spacer","group":"b6d52961.196668","order":1,"width":"8","height":"1"},{"id":"6256ee51.4808","type":"ui_group","z":"","name":"Dias","tab":"e1b7f5f3.0b6ab8","order":2,"disp":true,"width":"8","collapse":false},{"id":"62f31826.772e28","type":"ui_spacer","name":"spacer","group":"6256ee51.4808","order":9,"width":"8","height":1},{"id":"e9229fb4.84a14","type":"ui_spacer","name":"spacer","group":"6256ee51.4808","order":1,"width":"8","height":1},{"id":"e6a57b48.64b4a8","type":"ui_group","z":"","name":"Tiempo de riego por canal","tab":"e1b7f5f3.0b6ab8","order":3,"disp":true,"width":"8","collapse":false},{"id":"89ba4b19.b941e8","type":"ui_group","z":"","name":"Acciones","tab":"e1b7f5f3.0b6ab8","order":4,"disp":true,"width":"8","collapse":false},{"id":"353193e2.3064fc","type":"mqtt-broker","z":"","name":"Brokker_domotica","broker":"192.168.0.166","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"b2c6e7a.a81ab18","type":"ui_spacer","name":"spacer","group":"89ba4b19.b941e8","order":2,"width":1,"height":1},{"id":"3afc7b88.263a54","type":"ui_group","z":"","name":"Hora de encendido","tab":"e1b7f5f3.0b6ab8","order":1,"disp":true,"width":"6","collapse":false},{"id":"16412209.8f2dee","type":"telegrambot-config","z":"","botname":"domobot","usernames":"","chatIds":"594372466","pollInterval":"300"},{"id":"1db130b2.f3c89f","type":"ui_tab","z":"","name":"Home","icon":"home","order":1,"disabled":false,"hidden":false},{"id":"75619023.4637b","type":"ui_group","z":"","name":"Riego manual","tab":"e1b7f5f3.0b6ab8","disp":true,"width":"8","collapse":false},{"id":"fb6200bb.c228d","type":"ui_group","z":"","name":"Dispositivo Nuevos","tab":"1db130b2.f3c89f","order":1,"disp":true,"width":"6","collapse":false},{"id":"c75bf9d7.1a78b8","type":"ui_spacer","name":"spacer","group":"fb6200bb.c228d","order":2,"width":"0","height":"0"},{"id":"c6a120a5.09b4f","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"devices","tz":""},{"id":"a7cf1fe4.c0ab9","type":"ui_group","z":"","name":"Dispositivos registrados","tab":"1db130b2.f3c89f","order":2,"disp":true,"width":"12","collapse":false},{"id":"1e9b1326.5b8a7d","type":"ui_group","z":"","name":"termostato","tab":"1db130b2.f3c89f","disp":true,"width":"10","collapse":false},{"id":"b5a8c17d.11ef7","type":"ui_group","z":"","name":"test","tab":"ed892ca0.c9ea6","disp":true,"width":"12"},{"id":"ed892ca0.c9ea6","type":"ui_tab","z":"","name":"Test","icon":"dashboard"},{"id":"690ae1c7.d6d05","type":"ui_spacer","name":"spacer","group":"1e9b1326.5b8a7d","order":9,"width":"10","height":1},{"id":"2ccfb2e6.8f96ae","type":"ui_spacer","name":"spacer","group":"1e9b1326.5b8a7d","order":13,"width":"10","height":1},{"id":"c564589c.16cf58","type":"ui_spacer","name":"spacer","group":"1e9b1326.5b8a7d","order":2,"width":"6","height":1},{"id":"131d7c1.ba0c584","type":"ui_spacer","name":"spacer","group":"1e9b1326.5b8a7d","order":6,"width":"5","height":"5"},{"id":"1eea9cb8.f74fe3","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Lunes","tooltip":"","group":"6256ee51.4808","order":2,"width":"8","height":"1","passthru":true,"decouple":"false","topic":"lunes","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":350,"y":320,"wires":[["f6863d77.76ef8"]]},{"id":"17ee3fed.633ed","type":"ui_button","z":"d7ce74a.43e7388","name":"","group":"89ba4b19.b941e8","order":3,"width":0,"height":0,"passthru":false,"label":"Guardar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"guardar","x":620,"y":820,"wires":[["644d8d3.b6afa74"]]},{"id":"5987dbaa.0f3ac4","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Martes","tooltip":"","group":"6256ee51.4808","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"martes","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":380,"wires":[["ed8de645.11e578"]]},{"id":"a0f403d2.27998","type":"file","z":"d7ce74a.43e7388","name":"","filename":"resources/configuraciones/riego.json","appendNewline":false,"createDir":false,"overwriteFile":"true","x":1090,"y":820,"wires":[[]]},{"id":"ee0e806d.5c6d5","type":"function","z":"d7ce74a.43e7388","name":"lunes","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.lunes;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":320,"wires":[["1eea9cb8.f74fe3","bb6fc4de.285108"]]},{"id":"e2f26495.f02f58","type":"file in","z":"d7ce74a.43e7388","name":"","filename":"resources/configuraciones/riego.json","format":"utf8","chunk":false,"sendError":false,"x":370,"y":160,"wires":[["2c038578.55e6da"]]},{"id":"b22fdd7c.b7677","type":"inject","z":"d7ce74a.43e7388","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":160,"wires":[["e2f26495.f02f58"]]},{"id":"2c038578.55e6da","type":"json","z":"d7ce74a.43e7388","name":"configuracionRiego","property":"payload","action":"obj","pretty":false,"x":210,"y":220,"wires":[["546f443d.5da75c"]]},{"id":"a44b6b71.fcfc58","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Miercoles","tooltip":"","group":"6256ee51.4808","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"miercoles","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":440,"wires":[["967c4930.04b488"]]},{"id":"dc550438.e39a18","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Jueves","tooltip":"","group":"6256ee51.4808","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"jueves","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":500,"wires":[["6f93a289.07900c"]]},{"id":"3ed48153.b858fe","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Viernes","tooltip":"","group":"6256ee51.4808","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"viernes","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":560,"wires":[["855eeb6f.313308"]]},{"id":"3c017966.acb4f6","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Sabado","tooltip":"","group":"6256ee51.4808","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"sabado","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":620,"wires":[["4b692f8f.47a43"]]},{"id":"c3d283bb.11e12","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Domingo","tooltip":"","group":"6256ee51.4808","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"domingo","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":360,"y":680,"wires":[["e2947237.92f19"]]},{"id":"8a6b1431.824e08","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 1","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":"8","height":"1","passthru":true,"topic":"canal1","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":320,"wires":[["ea5a6f17.fa715"]]},{"id":"f38e97f5.a87ef8","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 2","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal2","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":380,"wires":[["da16374d.45da38"]]},{"id":"546f443d.5da75c","type":"change","z":"d7ce74a.43e7388","name":"","rules":[{"t":"set","p":"DatosRiego","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":220,"wires":[["ee0e806d.5c6d5","b98077d1.238b28","6de0598.b0c96a8","dd22aa7.7ceb058"]]},{"id":"bb6fc4de.285108","type":"function","z":"d7ce74a.43e7388","name":"martes","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.martes;\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":380,"wires":[["5987dbaa.0f3ac4","6e24fc71.8d7d84"]]},{"id":"6e24fc71.8d7d84","type":"function","z":"d7ce74a.43e7388","name":"miercoles","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.miercoles;\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":440,"wires":[["a3287e55.6bf7a","a44b6b71.fcfc58"]]},{"id":"a3287e55.6bf7a","type":"function","z":"d7ce74a.43e7388","name":"jueves","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.jueves;\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":500,"wires":[["dc550438.e39a18","a0f1a1cf.e4e4d"]]},{"id":"a0f1a1cf.e4e4d","type":"function","z":"d7ce74a.43e7388","name":"viernes","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.viernes;\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":560,"wires":[["18a0c640.61eb2a","3ed48153.b858fe"]]},{"id":"18a0c640.61eb2a","type":"function","z":"d7ce74a.43e7388","name":"sabado","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.sabado;\nreturn msg;","outputs":1,"noerr":0,"x":178.01953125,"y":618.75390625,"wires":[["3c017966.acb4f6","bab3238f.a48ba"]]},{"id":"bab3238f.a48ba","type":"function","z":"d7ce74a.43e7388","name":"domingo","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.domingo;\nreturn msg;","outputs":1,"noerr":0,"x":180,"y":680,"wires":[["c3d283bb.11e12"]]},{"id":"b98077d1.238b28","type":"function","z":"d7ce74a.43e7388","name":"canal 1","func":"var testval = flow.get('DatosRiego');\nif(testval.canal1 === null){\nmsg.payload=2;}else msg.payload=testval.canal1;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":320,"wires":[["8a6b1431.824e08","11db53cb.524ecc"]]},{"id":"11db53cb.524ecc","type":"function","z":"d7ce74a.43e7388","name":"canal 2","func":"var testval = flow.get('DatosRiego');\nif(testval.canal2 === null){\nmsg.payload=2;}else msg.payload=testval.canal2;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":380,"wires":[["f38e97f5.a87ef8","253dbf1e.02ff"]]},{"id":"f6863d77.76ef8","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.lunes=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":320,"wires":[[]]},{"id":"ed8de645.11e578","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.martes=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":380,"wires":[[]]},{"id":"967c4930.04b488","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.miercoles=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":440,"wires":[[]]},{"id":"6f93a289.07900c","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.jueves=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":500,"wires":[[]]},{"id":"855eeb6f.313308","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.viernes=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":560,"wires":[[]]},{"id":"4b692f8f.47a43","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.sabado=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":487.01953125,"y":620.25390625,"wires":[[]]},{"id":"e2947237.92f19","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.domingo=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":490,"y":680,"wires":[[]]},{"id":"ea5a6f17.fa715","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.canal1=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":320,"wires":[[]]},{"id":"da16374d.45da38","type":"function","z":"d7ce74a.43e7388","name":"canal2","func":"var testval = flow.get('DatosRiego');\ntestval.canal2=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":380,"wires":[[]]},{"id":"644d8d3.b6afa74","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\n//msg = testval;\nreturn {payload:testval};","outputs":1,"noerr":0,"x":790,"y":820,"wires":[["a0f403d2.27998"]]},{"id":"4659f630.a768a8","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 3","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal3","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":440,"wires":[["2547d01f.0a64d"]]},{"id":"dcb1549b.58b278","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 4","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal4","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":500,"wires":[["2253561f.f2607a"]]},{"id":"253dbf1e.02ff","type":"function","z":"d7ce74a.43e7388","name":"canal 3","func":"var testval = flow.get('DatosRiego');\nif(testval.canal3 === null){\nmsg.payload=2;}else msg.payload=testval.canal3;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":440,"wires":[["4659f630.a768a8","353d8caf.878cc4"]]},{"id":"353d8caf.878cc4","type":"function","z":"d7ce74a.43e7388","name":"canal 4","func":"var testval = flow.get('DatosRiego');\nif(testval.canal4 === null){\nmsg.payload=2;}else msg.payload=testval.canal4;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":500,"wires":[["dcb1549b.58b278","3db6af17.fd315"]]},{"id":"2547d01f.0a64d","type":"function","z":"d7ce74a.43e7388","name":"canal3","func":"var testval = flow.get('DatosRiego');\ntestval.canal3=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":440,"wires":[[]]},{"id":"2253561f.f2607a","type":"function","z":"d7ce74a.43e7388","name":"canal4","func":"var testval = flow.get('DatosRiego');\ntestval.canal4=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":500,"wires":[[]]},{"id":"658819b2.69c048","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 5","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal5","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":560,"wires":[["b634e42b.728008"]]},{"id":"15efd1e7.82a6ee","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 6","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal6","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":620,"wires":[["6dcd84a.c04797c"]]},{"id":"3db6af17.fd315","type":"function","z":"d7ce74a.43e7388","name":"canal 5","func":"var testval = flow.get('DatosRiego');\nif(testval.canal5 === null){\nmsg.payload=2;}else msg.payload=testval.canal5;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":560,"wires":[["658819b2.69c048","a7e2d28.720de3"]]},{"id":"a7e2d28.720de3","type":"function","z":"d7ce74a.43e7388","name":"canal 6","func":"var testval = flow.get('DatosRiego');\nif(testval.canal6 === null){\nmsg.payload=2;}else msg.payload=testval.canal6;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":620,"wires":[["15efd1e7.82a6ee","fd3b060f.b4c918"]]},{"id":"b634e42b.728008","type":"function","z":"d7ce74a.43e7388","name":"canal5","func":"var testval = flow.get('DatosRiego');\ntestval.canal5=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":560,"wires":[[]]},{"id":"6dcd84a.c04797c","type":"function","z":"d7ce74a.43e7388","name":"canal6","func":"var testval = flow.get('DatosRiego');\ntestval.canal6=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":620,"wires":[[]]},{"id":"50dce440.3fdc1c","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 7","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal7","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":680,"wires":[["bd9f690f.78a8b8"]]},{"id":"50220df9.ee39b4","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Valvula 8","tooltip":"","group":"e6a57b48.64b4a8","order":1,"width":0,"height":0,"passthru":true,"topic":"canal8","format":"{{value}}","min":0,"max":"99","step":1,"x":880,"y":740,"wires":[["b0e02ba2.d12c98"]]},{"id":"fd3b060f.b4c918","type":"function","z":"d7ce74a.43e7388","name":"canal 7","func":"var testval = flow.get('DatosRiego');\nif(testval.canal7 === null){\nmsg.payload=2;}else msg.payload=testval.canal7;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":680,"wires":[["50dce440.3fdc1c","433022ee.43b07c"]]},{"id":"433022ee.43b07c","type":"function","z":"d7ce74a.43e7388","name":"canal 8","func":"var testval = flow.get('DatosRiego');\nif(testval.canal8 === null){\nmsg.payload=2;}else msg.payload=testval.canal8;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":740,"wires":[["50220df9.ee39b4"]]},{"id":"bd9f690f.78a8b8","type":"function","z":"d7ce74a.43e7388","name":"canal7","func":"var testval = flow.get('DatosRiego');\ntestval.canal7=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":680,"wires":[[]]},{"id":"b0e02ba2.d12c98","type":"function","z":"d7ce74a.43e7388","name":"canal8","func":"var testval = flow.get('DatosRiego');\ntestval.canal8=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1010,"y":740,"wires":[[]]},{"id":"4ad17030.79b1d","type":"ui_switch","z":"d7ce74a.43e7388","name":"","label":"Estado On/Off","tooltip":"","group":"89ba4b19.b941e8","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"onOff","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":900,"y":220,"wires":[["c81c4611.fd5ca8"]]},{"id":"6de0598.b0c96a8","type":"function","z":"d7ce74a.43e7388","name":"Riego on off","func":"var testval = flow.get('DatosRiego');\nmsg.payload=testval.onOff;\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":220,"wires":[["4ad17030.79b1d"]]},{"id":"c81c4611.fd5ca8","type":"function","z":"d7ce74a.43e7388","name":"Estado","func":"var testval = flow.get('DatosRiego');\ntestval.onOff=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":1080,"y":220,"wires":[[]]},{"id":"5881fa78.5e60a4","type":"inject","z":"f25737d2.a56978","name":"","topic":"","payload":"DatosRiegoLocal","payloadType":"flow","repeat":"5","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":500,"wires":[["390179be.3454d6"]]},{"id":"37d73dd0.a1d8c2","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Hora","tooltip":"","group":"3afc7b88.263a54","order":9,"width":0,"height":0,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"23","step":1,"x":850,"y":100,"wires":[["d15dee1c.815f8"]]},{"id":"3e07035a.0664fc","type":"ui_numeric","z":"d7ce74a.43e7388","name":"","label":"Minutos","tooltip":"","group":"3afc7b88.263a54","order":10,"width":0,"height":0,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":"59","step":1,"x":840,"y":160,"wires":[["95c9373.68504c8"]]},{"id":"dd22aa7.7ceb058","type":"function","z":"d7ce74a.43e7388","name":"horas","func":"var testval = flow.get('DatosRiego');\nif(testval.horas === null){\nmsg.payload=0;}else msg.payload=testval.horas;\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":100,"wires":[["f2ce1dd8.2e89a","37d73dd0.a1d8c2"]]},{"id":"f2ce1dd8.2e89a","type":"function","z":"d7ce74a.43e7388","name":"minutos","func":"var testval = flow.get('DatosRiego');\nif(testval.minutos === null){\nmsg.payload=0;}else msg.payload=testval.minutos;\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":160,"wires":[["3e07035a.0664fc"]]},{"id":"d15dee1c.815f8","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.horas=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":990,"y":100,"wires":[[]]},{"id":"95c9373.68504c8","type":"function","z":"d7ce74a.43e7388","name":"canal1","func":"var testval = flow.get('DatosRiego');\ntestval.minutos=msg.payload;\nreturn testval;","outputs":1,"noerr":0,"x":970,"y":160,"wires":[[]]},{"id":"1752e121.9f253f","type":"function","z":"f25737d2.a56978","name":"comprueba dia semana","func":"var testval = flow.get('DatosRiegoLocal');\nvar horas = new Date();\n\nvar diaSemana = [testval.domingo,\n                 testval.lunes,\n                 testval.martes,\n                 testval.miercoles,\n                 testval.jueves,\n                 testval.viernes,\n                 testval.sabado];\nvar dia = horas.getDay();      \nvar diaActivo = diaSemana[dia];\n\nmsg.payload = diaActivo;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":680,"wires":[["3535127c.4ea11e"]]},{"id":"3535127c.4ea11e","type":"switch","z":"f25737d2.a56978","name":"dia semana activo","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":740,"wires":[["8ea2adab.13cfe"],[]],"outputLabels":["dia programado",""]},{"id":"8ea2adab.13cfe","type":"function","z":"f25737d2.a56978","name":"comprueba hora","func":"var testval = flow.get('DatosRiegoLocal');\nvar funcionando = flow.get('Activo'); \nvar horas = new Date();\nvar hora = horas.getHours();\nvar minutos = horas.getMinutes();\nif(hora === testval.horas && minutos === testval.minutos){\n    \n    funcionando = true;\n    flow.set('Activo', funcionando);\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":800,"wires":[[]]},{"id":"22f020be.085b6","type":"switch","z":"f25737d2.a56978","name":"comprueba actividad","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":620,"wires":[["1752e121.9f253f"],[]],"outputLabels":["activo",""]},{"id":"c608d316.1550b","type":"function","z":"f25737d2.a56978","name":"comprueba Activo","func":"var testval = flow.get('DatosRiegoLocal');\nvar onOff = testval.onOff;\nmsg.payload = onOff;\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":560,"wires":[["22f020be.085b6"]]},{"id":"390179be.3454d6","type":"switch","z":"f25737d2.a56978","name":"flag para riego activo","property":"Activo","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":true,"outputs":2,"x":440,"y":500,"wires":[["b8dfea6d.0e16d8"],["c608d316.1550b"]]},{"id":"d75a4884.abb418","type":"function","z":"f25737d2.a56978","name":"crea Json","func":"var valores = {\n  \"canal\" : \"2\",\n  \"status\" : \"off\",\n  \"final\" : \"no\"\n};\nvalores.canal = msg.canal\nvalores.status = msg.estado;\nvalores.final = msg.final;\nmsg.payload = valores\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":560,"wires":[["c16262d.d5baaa"]]},{"id":"9280234d.af151","type":"mqtt out","z":"f25737d2.a56978","name":"riego jardin","topic":"","qos":"0","retain":"","broker":"353193e2.3064fc","x":1330,"y":820,"wires":[]},{"id":"b8dfea6d.0e16d8","type":"function","z":"f25737d2.a56978","name":"calcula tiempos","func":"var canales = flow.get('DatosRiegoLocal');\nvar funcionando = flow.get('Activo') || true;\nvar tiempohora = context.get('Tiempohora') || 0;\nvar tiempomin = context.get('Tiempomin') || 0;\nvar regando = flow.get('Regando') || false;\nvar indice = context.get('Indice') || 0;\nvar reloj = new Date();\nvar resto = 0;\nvar matriz = [canales.canal1,\n              canales.canal2,\n              canales.canal3,\n              canales.canal4,\n              canales.canal5,\n              canales.canal6,\n              canales.canal7,\n              canales.canal8\n              ];\n              \n    if(indice == 8){\n        funcionando = false;\n        indice = 0;\n        context.set('Indice', indice);\n        flow.set('Activo', funcionando);\n        msg.final = \"finalizado\";\n        return msg;\n    }\n              \n\n    if(matriz[indice] > 0 && regando === false){\n        \n       \n        tiempomin = reloj.getMinutes();\n        \n        if((tiempomin + matriz[indice]) > 59){\n            tiempomin = tiempomin+matriz[indice]-60;\n            resto = 1;\n        }else{\n            \n            tiempomin = tiempomin+matriz[indice];\n            resto = 0;\n        }\n        \n         tiempohora = reloj.getHours()+resto;\n         \n         regando = true;\n        \n        context.set('Tiempohora', tiempohora);\n        context.set('Tiempomin', tiempomin);\n        flow.set('Regando', regando);\n       msg.payload = \"inician riego en sector \" + indice + \" finaliza a las \" + tiempohora + \":\" + tiempomin;\n       msg.canal = indice;\n       msg.estado = \"on\";\n       return msg;\n    }\n    \n    /* comprueba el riego por canal una vez iniciado\n    carga hora y minutos y los compara con los guardados\n    si coinciden reinicia las variables para proximo ciclo */\n    \n    if(regando === true){\n        \n       if(tiempohora === reloj.getHours() && tiempomin === reloj.getMinutes()){\n           \n            regando = false;\n            \n            tiempohora = 0;\n            tiempomin = 0;\n            context.set('Tiempohora', tiempohora);\n            context.set('Tiempomin', tiempomin);\n            //funcionando = false;\n            \n            flow.set('Regando', regando);\n        \n            msg.canal = indice;\n            msg.estado = \"off\";\n            msg.final = \"no\";\n            indice += 1;\n            context.set('Indice', indice);\n            return msg;\n       }\n        \n        return;\n    }\n    \n    /*comprueba si canal contiene 0 en tiempo y pasa a siguiente*/\n    if(matriz[indice] === 0){\n            regando = false;\n            \n            tiempohora = 0;\n            tiempomin = 0;\n            context.set('Tiempohora', tiempohora);\n            context.set('Tiempomin', tiempomin);\n            indice += 1;\n            context.set('Indice', indice);\n        \n            flow.set('Regando', regando);\n            return;\n        \n    }\n\n    \n    \n    return null;","outputs":1,"noerr":0,"x":720,"y":500,"wires":[["c7025296.f7c12","d75a4884.abb418"]]},{"id":"c16262d.d5baaa","type":"switch","z":"f25737d2.a56978","name":"mensaje vacio","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":720,"y":640,"wires":[["23eeb430.8586cc","f0d6449a.7c7e98","d109016b.9fbc2"],[]]},{"id":"775e5889.dc43d8","type":"debug","z":"f25737d2.a56978","name":"salida subrutina inactiva","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1170,"y":1220,"wires":[]},{"id":"831cd95d.aec2a8","type":"debug","z":"f25737d2.a56978","name":"Telegram","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1160,"y":660,"wires":[]},{"id":"eddc167.6578de8","type":"telegrambot-notify","z":"d790f34d.d1733","name":"","bot":"16412209.8f2dee","chatId":"594372466","message":"Hola!!! vuelvo a estar activo","parseMode":"","x":620,"y":40,"wires":[]},{"id":"bba1e7c4.382818","type":"inject","z":"d790f34d.d1733","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":40,"wires":[["428ec49c.d66fec"]]},{"id":"23eeb430.8586cc","type":"function","z":"f25737d2.a56978","name":"Aviso Telegram inicio","func":"if(msg.payload.status === \"on\"){\nmsg.payload = \"Riego iniciado en canal \" + msg.payload.canal;\nreturn msg;\n}\n\nreturn","outputs":1,"noerr":0,"x":960,"y":620,"wires":[["831cd95d.aec2a8","4fdf0491.01352c"]]},{"id":"4fdf0491.01352c","type":"telegrambot-notify","z":"f25737d2.a56978","name":"aviso inicio riego","bot":"16412209.8f2dee","chatId":"594372466","message":"","parseMode":"","x":1190,"y":600,"wires":[]},{"id":"f0d6449a.7c7e98","type":"function","z":"f25737d2.a56978","name":"Aviso Telegram fin","func":"if( msg.payload.final === \"finalizado\"){\nreturn msg;\n}\n\nreturn","outputs":1,"noerr":0,"x":950,"y":660,"wires":[["a5929e98.0b77e","b5667efb.151c5"]]},{"id":"a5929e98.0b77e","type":"telegrambot-notify","z":"f25737d2.a56978","name":"aviso fin riego","bot":"16412209.8f2dee","chatId":"594372466","message":"Riego automatico finalizado!","parseMode":"","x":1220,"y":720,"wires":[]},{"id":"b5667efb.151c5","type":"debug","z":"f25737d2.a56978","name":"Telegram","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1200,"y":780,"wires":[]},{"id":"e6f8e220.f573f","type":"inject","z":"d7ce74a.43e7388","name":"","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"3","x":110,"y":80,"wires":[["dbfbce72.37858"]]},{"id":"dbfbce72.37858","type":"change","z":"d7ce74a.43e7388","name":"flow botones riego manual","rules":[{"t":"set","p":"BotonRiegoManual","pt":"flow","to":"0","tot":"str"},{"t":"set","p":"botonAnterior","pt":"flow","to":"none","tot":"str"},{"t":"set","p":"botonActual","pt":"flow","to":"none","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":80,"wires":[[]]},{"id":"439a84fc.7ed9ec","type":"ui_button","z":"d7ce74a.43e7388","name":"valv 1","group":"75619023.4637b","order":8,"width":"2","height":"2","passthru":false,"label":"{{msg.text}}","tooltip":"","color":"{{msg.color}}","bgcolor":"{{msg.background}}","icon":"","payload":"BotonRiegoManual","payloadType":"flow","topic":"button","x":750,"y":940,"wires":[["d930c7c5.01b3b8"]]},{"id":"889adb6b.36b7a8","type":"switch","z":"d7ce74a.43e7388","name":"ON/OFF state","property":"BotonRiegoManual","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":940,"wires":[["b53b1d16.0b49b"],["6da6ba76.819124"]]},{"id":"b53b1d16.0b49b","type":"function","z":"d7ce74a.43e7388","name":"if is on","func":"msg.color = \"black\";\nmsg.background = \"#EF2F4F\";\nmsg.text = \"valv 8\";\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":920,"wires":[["439a84fc.7ed9ec"]]},{"id":"6da6ba76.819124","type":"function","z":"d7ce74a.43e7388","name":"if its off","func":"msg.color = \"black\";\nmsg.background = \"#B4EEB4\";\nmsg.text = \"valv 8\";\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":960,"wires":[["439a84fc.7ed9ec"]]},{"id":"d930c7c5.01b3b8","type":"switch","z":"d7ce74a.43e7388","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"button","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":870,"y":940,"wires":[["1740e5a8.d5364a"]]},{"id":"1740e5a8.d5364a","type":"function","z":"d7ce74a.43e7388","name":"","func":"var obtaindata = flow.get (\"BotonRiegoManual\")\nvar botonAnterior = flow.get(\"botonAnterior\")\nif (obtaindata == \"1\"){msg.payload = 0}\nif (obtaindata == \"0\"){msg.payload = 1}\n//botonAnterior = \"8\";\n//msg.payload.boton = botonAnterior;\nreturn msg;\n\n","outputs":1,"noerr":0,"x":990,"y":940,"wires":[["1de7b5ac.9d8f0a"]]},{"id":"1de7b5ac.9d8f0a","type":"change","z":"d7ce74a.43e7388","name":"re-wirte switch variable","rules":[{"t":"move","p":"payload","pt":"msg","to":"BotonRiegoManual","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":940,"wires":[[]]},{"id":"172b7cdc.e1fd83","type":"inject","z":"d7ce74a.43e7388","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":0.1,"x":270,"y":940,"wires":[["889adb6b.36b7a8"]]},{"id":"cb905817.ba3728","type":"inject","z":"f25737d2.a56978","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":110,"y":120,"wires":[["27ecd623.2dc80a"]]},{"id":"27ecd623.2dc80a","type":"change","z":"f25737d2.a56978","name":"","rules":[{"t":"set","p":"cliente","pt":"flow","to":"serverSwitch/jardinRiego/riego/switch","tot":"str"},{"t":"set","p":"Activo","pt":"flow","to":"false","tot":"bool"},{"t":"set","p":"Regando","pt":"flow","to":"false","tot":"bool"},{"t":"set","p":"DeviceStatus","pt":"flow","to":"true","tot":"bool"},{"t":"set","p":"DatosRiegoLocal","pt":"flow","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":120,"wires":[["88bdd5c4.42f998"]]},{"id":"d109016b.9fbc2","type":"change","z":"f25737d2.a56978","name":"subscribe a tema","rules":[{"t":"set","p":"topic","pt":"msg","to":"cliente","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":820,"wires":[["9280234d.af151"]]},{"id":"6df372e0.87350c","type":"inject","z":"d790f34d.d1733","name":"","topic":"SELECT * FROM `casa`","payload":"","payloadType":"date","repeat":"15","crontab":"","once":true,"onceDelay":"1","x":110,"y":520,"wires":[["57e6a097.c9128"]]},{"id":"a816a30a.16366","type":"catch","z":"f25737d2.a56978","name":"","scope":["9280234d.af151"],"x":930,"y":1220,"wires":[["775e5889.dc43d8"]]},{"id":"dc276387.9cba4","type":"telegrambot-command","z":"f25737d2.a56978","name":"reactivar","bot":"16412209.8f2dee","command":"/reset","commandType":"str","commandCase":false,"x":1000,"y":120,"wires":[["b01a59bd.5ee3b8"]]},{"id":"b01a59bd.5ee3b8","type":"telegrambot-notify","z":"f25737d2.a56978","name":"aviso inicio riego","bot":"16412209.8f2dee","chatId":"594372466","message":"ok","parseMode":"","x":1390,"y":120,"wires":[]},{"id":"79f8f67f.443468","type":"mqtt out","z":"f25737d2.a56978","name":"reset en inicio","topic":"","qos":"0","retain":"","broker":"353193e2.3064fc","x":820,"y":120,"wires":[]},{"id":"a02e7a8d.53ad28","type":"change","z":"f25737d2.a56978","name":"subscribe a tema","rules":[{"t":"set","p":"topic","pt":"msg","to":"cliente","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":120,"wires":[["79f8f67f.443468"]]},{"id":"88bdd5c4.42f998","type":"function","z":"f25737d2.a56978","name":"crea Json","func":"var valores = {\n  \"canal\" : \"2\",\n  \"status\" : \"off\",\n  \"final\" : \"no\"\n};\n\nvalores.status = \"reset\";\n\nmsg.payload = valores\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":120,"wires":[["a02e7a8d.53ad28"]]},{"id":"f9a9ff95.b96ee","type":"mqtt in","z":"d790f34d.d1733","name":"Nuevos dispositivos","topic":"devices/#","qos":"1","broker":"353193e2.3064fc","x":110,"y":120,"wires":[["62c09e91.1ddf8"]]},{"id":"ffd6e3a8.0f79a","type":"ui_button","z":"d790f34d.d1733","name":"Buscar Nuevos","group":"fb6200bb.c228d","order":3,"width":"3","height":"2","passthru":false,"label":"Descubrir","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Mensaje","payloadType":"flow","topic":"","x":900,"y":120,"wires":[["541e5262.b5e51c"]]},{"id":"2f18409.53587c","type":"ui_text","z":"d790f34d.d1733","group":"fb6200bb.c228d","order":1,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":1190,"y":120,"wires":[]},{"id":"5160b464.111b0c","type":"function","z":"d790f34d.d1733","name":"Recibe datos","func":"var identificador = flow.get('nuevosDispositivos');\nvar mensaje = flow.get('Mensaje');\nmensaje = identificador.id;\nflow.set('Mensaje', mensaje);\nmsg.payload = mensaje;\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":120,"wires":[["ffd6e3a8.0f79a"]]},{"id":"c7877760.2c7ce8","type":"comment","z":"d790f34d.d1733","name":"mostrar dispositivos ","info":"muestra todos los dispositivos de la base de \ndatos","x":150,"y":480,"wires":[]},{"id":"8053d87e.865678","type":"change","z":"d790f34d.d1733","name":"Datos del dispositivo","rules":[{"t":"set","p":"nuevosDispositivos","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":120,"wires":[["5160b464.111b0c"]]},{"id":"e143c5e5.7223e8","type":"mqtt out","z":"d790f34d.d1733","name":"","topic":"device/setup","qos":"0","retain":"","broker":"353193e2.3064fc","x":1230,"y":280,"wires":[]},{"id":"c7025296.f7c12","type":"debug","z":"f25737d2.a56978","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":480,"wires":[]},{"id":"62c09e91.1ddf8","type":"json","z":"d790f34d.d1733","name":"","property":"payload","action":"","pretty":false,"x":330,"y":120,"wires":[["8053d87e.865678"]]},{"id":"ae14cc3b.8f296","type":"ui_button","z":"d790f34d.d1733","name":"guardar","group":"fb6200bb.c228d","order":4,"width":"3","height":"2","passthru":false,"label":"Guardar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"save","payloadType":"str","topic":"","x":100,"y":220,"wires":[["3ab8cd9b.76d9d2"]]},{"id":"428ec49c.d66fec","type":"change","z":"d790f34d.d1733","name":"","rules":[{"t":"set","p":"nuevosDispositivos","pt":"flow","to":"none","tot":"str"},{"t":"set","p":"Mensaje","pt":"flow","to":"none","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":40,"wires":[[]]},{"id":"541e5262.b5e51c","type":"function","z":"d790f34d.d1733","name":"NO hay","func":"var identificador = flow.get('nuevosDispositivos');\nvar mensaje = flow.get('Mensaje');\n\n    if(identificador == \"none\"){\n    mensaje = \"No hay nuevos\";\n    flow.set('Mensaje', mensaje);\n    msg.payload = mensaje;\n    return msg;\n    }\n    \nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":100,"wires":[["2f18409.53587c"]]},{"id":"96a901f1.8e289","type":"mysql","z":"d790f34d.d1733","mydb":"c6a120a5.09b4f","name":"","x":480,"y":220,"wires":[["62d1a01e.b018b"]]},{"id":"3ab8cd9b.76d9d2","type":"function","z":"d790f34d.d1733","name":"MYSQL Query","func":"var campos = flow.get('nuevosDispositivos');\n\nvar topic = \"INSERT IGNORE INTO casa (Nombre, Canales, categoria) VALUES (\";\ntopic += \"\\\"\";\ntopic += campos.id;\ntopic += \"\\\"\";\ntopic += ',';\ntopic += \"\\\"\";\ntopic += campos.canales;\ntopic += \"\\\"\";\ntopic += ',';\ntopic += \"\\\"\";\ntopic += campos.categoria;\ntopic += \"\\\"\";\ntopic += \")\";\n\nmsg.topic = topic;\nmsg.payload = campos; \nreturn msg;","outputs":1,"noerr":0,"x":300,"y":220,"wires":[["96a901f1.8e289"]]},{"id":"62d1a01e.b018b","type":"switch","z":"d790f34d.d1733","name":"","property":"payload.warningCount","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":280,"wires":[["2df89b42.145e14","67ed41f.3ebfec"],["b8c3c3bb.81012"]]},{"id":"2df89b42.145e14","type":"ui_toast","z":"d790f34d.d1733","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"Dispositivo agregado a la base de datos","name":"","x":870,"y":260,"wires":[]},{"id":"b8c3c3bb.81012","type":"ui_toast","z":"d790f34d.d1733","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"No se pudo guardar. cambie el nombre a su dispositivo","name":"","x":630,"y":340,"wires":[]},{"id":"67ed41f.3ebfec","type":"change","z":"d790f34d.d1733","name":"","rules":[{"t":"set","p":"nuevosDispositivos","pt":"flow","to":"none","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":340,"wires":[["3701d17e.6e887e","9235fbda.7688f8"]]},{"id":"9235fbda.7688f8","type":"change","z":"d790f34d.d1733","name":"borra texto en buscar","rules":[{"t":"set","p":"payload","pt":"msg","to":"none","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":240,"wires":[["2f18409.53587c"]]},{"id":"3701d17e.6e887e","type":"change","z":"d790f34d.d1733","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"registro","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":360,"wires":[["e143c5e5.7223e8"]]},{"id":"57e6a097.c9128","type":"mysql","z":"d790f34d.d1733","mydb":"c6a120a5.09b4f","name":"","x":260,"y":520,"wires":[["b464b3e1.52cf5"]]},{"id":"b464b3e1.52cf5","type":"ui_template","z":"d790f34d.d1733","group":"a7cf1fe4.c0ab9","name":"dispositivos","order":1,"width":"12","height":"12","format":"<style type=\"text/css\"> @import url(\"/styles/dispositives.css\"); </style>\n<table id=\"table\" border=\"5\">\n <tr>\n <th>Nombre</th>\n  <th>Categoria</th>\n </tr>\n <tbody>\n <tr ng-repeat=\"row in msg.payload\">\n <td class=\"nombres\">{{row.Nombre}}</td>\n <td class=\"categorias\">{{row.categoria}}</td>\n </tr>\n </tbody>\n</table>","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":430,"y":520,"wires":[[]]},{"id":"4de25746.4cce28","type":"mqtt in","z":"f25737d2.a56978","name":"","topic":"riego/status","qos":"1","broker":"353193e2.3064fc","x":90,"y":380,"wires":[["46dcec1d.612e24"]]},{"id":"46dcec1d.612e24","type":"function","z":"f25737d2.a56978","name":"keepAlive","func":"var devicestatus = flow.get('DeviceStatus');\nif(msg.payload === \"online\"){\n    msg.payload = \"en linea\";\n    devicestatus = true;\n    flow.set('DeviceStatus', devicestatus);\n    return [msg,null];\n}else{\n    devicestatus = false;\n    flow.set('DeviceStatus', devicestatus);\n    msg.payload = \"desconectado\";\n    return [null,msg];\n}\n","outputs":2,"noerr":0,"x":260,"y":380,"wires":[["fa947878.7d4d68"],["89ff13b2.8b51c"]]},{"id":"fa947878.7d4d68","type":"telegrambot-notify","z":"f25737d2.a56978","name":"aviso si conexion","bot":"16412209.8f2dee","chatId":"594372466","message":"Aviso!!! El dispositivo vuelve a estar online","parseMode":"","x":450,"y":360,"wires":[]},{"id":"89ff13b2.8b51c","type":"telegrambot-notify","z":"f25737d2.a56978","name":"aviso si conexion","bot":"16412209.8f2dee","chatId":"594372466","message":"Aviso!!! no hay conexion con el dispositivo.  No se pudo efectuar riego","parseMode":"","x":450,"y":420,"wires":[]},{"id":"f61e8f25.a7a18","type":"openweathermap in","z":"d790f34d.d1733","name":"El tiempo","wtype":"forecast","lon":"","lat":"","city":"terrassa","country":"barcelona","language":"es","x":220,"y":640,"wires":[["6c9f911b.51a18"]]},{"id":"6c9f911b.51a18","type":"debug","z":"d790f34d.d1733","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":640,"wires":[]},{"id":"45e0ee0e.be2e7","type":"inject","z":"f25737d2.a56978","name":"","topic":"","payload":"","payloadType":"date","repeat":"10","crontab":"","once":true,"onceDelay":"2","x":110,"y":220,"wires":[["e40ec5af.914558"]]},{"id":"e40ec5af.914558","type":"file in","z":"f25737d2.a56978","name":"riego.json","filename":"resources/configuraciones/riego.json","format":"utf8","chunk":false,"sendError":false,"x":320,"y":220,"wires":[["621ede83.13d51"]]},{"id":"621ede83.13d51","type":"json","z":"f25737d2.a56978","name":"configuracionRiego","property":"payload","action":"obj","pretty":false,"x":570,"y":220,"wires":[["745639a7.d8b188"]]},{"id":"745639a7.d8b188","type":"change","z":"f25737d2.a56978","name":"","rules":[{"t":"set","p":"DatosRiegoLocal","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]]},{"id":"e207f6e4.82abc8","type":"ui_template","z":"7deeec4c.206c84","group":"b5a8c17d.11ef7","name":"user input validate","order":4,"width":"7","height":"2","format":"<md-input-container  style=\"overflow:hidden;\">\n    <span> \n    <input ng-model=\"user.input\" style=\"width:150px\" placeholder={{msg.topic}}><button class=\"bluebutton\" ng-click=\"msg.payload = user.input; send(msg)\" ng-keypress=\"($event.charCode==13)?msg.payload = user.input; send(msg)\" ngstyle=\"{background-color: #008CBA;}\" style=\"\n    color: #fff;\n    background-color: #5bc0de;\n    border-color: #46b8da;\">Ok</button></span>\n</md-input-container>\n    ","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":550,"y":200,"wires":[["7a88d3ed.1de03c","af7c0c95.44068"]]},{"id":"7a88d3ed.1de03c","type":"debug","z":"7deeec4c.206c84","name":"","active":true,"console":"false","complete":"false","x":785,"y":185,"wires":[]},{"id":"86ec8a3d.40da48","type":"ui_template","z":"7deeec4c.206c84","group":"b5a8c17d.11ef7","name":"user input","order":6,"width":"7","height":"2","format":"<md-input-container  style=\"overflow:hidden;\">\n    <span> \n    <input ng-model=\"user.input\" style=\"width:150px\" placeholder=\"{{msg.topic}}\" ng-change=\"msg.payload = user.input; send(msg)\"></span>\n</md-input-container>\n    ","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":575,"y":250,"wires":[["7a88d3ed.1de03c","2ee451b0.b3c08e"]]},{"id":"32f4919d.ee781e","type":"inject","z":"7deeec4c.206c84","name":"","topic":"Name","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":355,"y":200,"wires":[["e207f6e4.82abc8"]]},{"id":"cbe1ef00.277cc","type":"inject","z":"7deeec4c.206c84","name":"","topic":"Topic","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":345,"y":250,"wires":[["86ec8a3d.40da48"]]},{"id":"2ee451b0.b3c08e","type":"ui_text","z":"7deeec4c.206c84","group":"b5a8c17d.11ef7","order":7,"width":"7","height":"1","name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":765,"y":255,"wires":[]},{"id":"af7c0c95.44068","type":"ui_text","z":"7deeec4c.206c84","group":"b5a8c17d.11ef7","order":5,"width":"7","height":"1","name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":770,"y":220,"wires":[]},{"id":"1f03a832.81f318","type":"ui_template","z":"c88d6057.281f6","group":"1e9b1326.5b8a7d","name":"Horario Dia","order":10,"width":0,"height":0,"format":"<style type=\"text/css\"> @import url(\"/styles/termostato.css\");</style>\n\n    <div id=\"cajas\">\n        <label id=\"etiquetas\">Horario de dia</label><br>\n    </div>\n    <div>\n    <label>Inicio&nbsp;&nbsp;</label>\n    \n    <input ng-model=\"hora.dia\" \n           type=\"number\" \n           min=\"0\" max=\"23\"\n           value=\"{{msg.payload[0]}}\" \n           ng-change=\"msg.payload[0] = hora.dia; send(msg)\">\n    <label>:</label>\n    \n    <input ng-model=\"minutos.dia\" \n           type=\"number\"\n            min=\"0\" max=\"59\"\n           value=\"{{msg.payload[1]}}\" \n           ng-change=\"msg.payload[1] = minutos.dia; send(msg)\">\n           \n    <label>&nbsp;&nbsp;Fin&nbsp;&nbsp;</label>\n    \n    <input ng-model=\"hora.diafin\" \n           type=\"number\"\n            min=\"0\" max=\"23\"\n           value=\"{{msg.payload[2]}}\" \n           ng-change=\"msg.payload[2] = hora.diafin; send(msg)\">\n           \n    <label>:</label>\n    \n    <input ng-model=\"minutos.diafin\" \n           type=\"number\"\n            min=\"0\" max=\"59\"\n           value=\"{{msg.payload[3]}}\" \n           ng-change=\"msg.payload[3] = minutos.diafin; send(msg)\">\n    </div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":430,"y":440,"wires":[["53438aa6.f75564"]]},{"id":"b2ed1fff.942bf","type":"debug","z":"c88d6057.281f6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":870,"y":440,"wires":[]},{"id":"56facf22.446c8","type":"ui_template","z":"c88d6057.281f6","group":"1e9b1326.5b8a7d","name":"Horario Noche","order":14,"width":0,"height":0,"format":"<style type=\"text/css\"> @import url(\"/styles/termostato.css\");</style>\n\n<div id=\"cajas\">\n<label id=\"etiquetas\">Horario de Noche</label>\n</div>\n<div>\n<label>Inicio&nbsp;&nbsp;</label>\n<input ng-model=\"hora.dia\" \n       type=\"number\" \n       min=\"0\" max=\"23\"\n       value=\"{{msg.payload[0]}}\" \n       ng-change=\"msg.payload[0] = hora.dia; send(msg)\">\n<label>:</label>\n<input ng-model=\"minutos.dia\" \n       type=\"number\"\n        min=\"0\" max=\"59\"\n       value=\"{{msg.payload[1]}}\" \n       ng-change=\"msg.payload[1] = minutos.dia; send(msg)\">\n<label>&nbsp;&nbsp;Fin&nbsp;&nbsp;</label>\n<input ng-model=\"hora.diafin\" \n       type=\"number\"\n        min=\"0\" max=\"23\"\n       value=\"{{msg.payload[2]}}\" \n       ng-change=\"msg.payload[2] = hora.diafin; send(msg)\">\n<label>:</label>\n<input ng-model=\"minutos.diafin\" \n       type=\"number\"\n        min=\"0\" max=\"59\"\n       value=\"{{msg.payload[3]}}\" \n       ng-change=\"msg.payload[3] = minutos.diafin; send(msg)\">\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":460,"y":600,"wires":[["6f0e04fe.884cbc"]]},{"id":"c28a2cd6.d7fd8","type":"ui_slider","z":"c88d6057.281f6","name":"","label":"TempDia","tooltip":"","group":"1e9b1326.5b8a7d","order":7,"width":"7","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"30","step":1,"x":500,"y":320,"wires":[["b1e03ff8.a8ff","2cc178f2.c77d88"]]},{"id":"2cc178f2.c77d88","type":"ui_text","z":"c88d6057.281f6","group":"1e9b1326.5b8a7d","order":8,"width":"3","height":"1","name":"","label":"","format":"{{msg.payload}}C","layout":"row-left","x":650,"y":320,"wires":[]},{"id":"ec6d1009.bbdff","type":"ui_slider","z":"c88d6057.281f6","name":"","label":"Temp","tooltip":"","group":"1e9b1326.5b8a7d","order":11,"width":"7","height":"1","passthru":true,"outs":"all","topic":"","min":0,"max":"30","step":1,"x":450,"y":500,"wires":[["8de7c969.756fa8","7b86a000.09267"]]},{"id":"8de7c969.756fa8","type":"ui_text","z":"c88d6057.281f6","group":"1e9b1326.5b8a7d","order":12,"width":"3","height":"1","name":"","label":"","format":"{{msg.payload}}C","layout":"row-left","x":610,"y":500,"wires":[]},{"id":"1573320.85c94ce","type":"file in","z":"c88d6057.281f6","name":"termostato.json","filename":"resources/configuraciones/termostato.json","format":"utf8","chunk":false,"sendError":false,"x":420,"y":200,"wires":[["64e547.75e48ab8"]]},{"id":"64e547.75e48ab8","type":"json","z":"c88d6057.281f6","name":"","property":"payload","action":"","pretty":false,"x":610,"y":200,"wires":[["4924ce90.e50bd"]]},{"id":"4924ce90.e50bd","type":"change","z":"c88d6057.281f6","name":"Termostato","rules":[{"t":"set","p":"termostato","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":200,"wires":[["9682247e.7cd058","6656ef43.04a05"]]},{"id":"c1dccc4d.1f2c6","type":"inject","z":"c88d6057.281f6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":170,"y":200,"wires":[["1573320.85c94ce","7142cbe3.8df544"]]},{"id":"9682247e.7cd058","type":"debug","z":"c88d6057.281f6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":990,"y":200,"wires":[]},{"id":"174e556.8f491ab","type":"change","z":"c88d6057.281f6","name":"hora dia","rules":[{"t":"set","p":"payload","pt":"msg","to":"termostato.HoraDia","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":440,"wires":[["1f03a832.81f318"]]},{"id":"53438aa6.f75564","type":"change","z":"c88d6057.281f6","name":"cambiaHoraDia","rules":[{"t":"set","p":"termostato.HoraDia","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":440,"wires":[["b2ed1fff.942bf"]]},{"id":"4365e3cd.f93c2c","type":"debug","z":"c88d6057.281f6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":710,"y":640,"wires":[]},{"id":"6e7d2642.81de18","type":"inject","z":"c88d6057.281f6","name":"","topic":"","payload":"termostato","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":640,"wires":[["4365e3cd.f93c2c"]]},{"id":"fbe2c05e.a4336","type":"change","z":"c88d6057.281f6","name":"hora Noche","rules":[{"t":"set","p":"payload","pt":"msg","to":"termostato.HoraNoche","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":600,"wires":[["56facf22.446c8"]]},{"id":"6f0e04fe.884cbc","type":"change","z":"c88d6057.281f6","name":"cambiaHoraNoche","rules":[{"t":"set","p":"termostato.HoraNoche","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":600,"wires":[["b2ed1fff.942bf"]]},{"id":"3622fb1c.a79e74","type":"ui_button","z":"c88d6057.281f6","name":"","group":"1e9b1326.5b8a7d","order":15,"width":"3","height":"2","passthru":false,"label":"Guardar","tooltip":"","color":"","bgcolor":"","icon":"save","payload":"termostato","payloadType":"flow","topic":"","x":260,"y":740,"wires":[["ccf9c342.04297"]]},{"id":"60bea023.4b655","type":"link in","z":"c88d6057.281f6","name":"inyecta","links":["6656ef43.04a05"],"x":155,"y":440,"wires":[["174e556.8f491ab","fbe2c05e.a4336"]]},{"id":"6656ef43.04a05","type":"link out","z":"c88d6057.281f6","name":"","links":["60bea023.4b655"],"x":955,"y":260,"wires":[]},{"id":"fb55e7.65c4da18","type":"ui_switch","z":"c88d6057.281f6","name":"","label":"OnOff","tooltip":"","group":"1e9b1326.5b8a7d","order":1,"width":"4","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":490,"y":260,"wires":[["6434f219.38e3bc"]]},{"id":"7142cbe3.8df544","type":"function","z":"c88d6057.281f6","name":"Envia datos","func":"var matriz = flow.get('termostato');\nmsg.payload = matriz.OnOff\nvar tempDia = {payload: matriz.tempDia}\nvar tempNoche = {payload: matriz.tempNoche}\nreturn [msg, tempDia, tempNoche];","outputs":3,"noerr":0,"x":310,"y":280,"wires":[["fb55e7.65c4da18"],["c28a2cd6.d7fd8"],["7609fd38.c03374"]]},{"id":"7609fd38.c03374","type":"link out","z":"c88d6057.281f6","name":"tempnoche","links":["e07fc56f.6ff8c8"],"x":455,"y":380,"wires":[]},{"id":"e07fc56f.6ff8c8","type":"link in","z":"c88d6057.281f6","name":"","links":["7609fd38.c03374"],"x":300,"y":500,"wires":[["ec6d1009.bbdff"]]},{"id":"70f0b3b2.72caac","type":"ui_gauge","z":"c88d6057.281f6","name":"","group":"1e9b1326.5b8a7d","order":3,"width":"5","height":"5","gtype":"gage","title":"Salon","label":"Grados","format":"{{value}}C","min":0,"max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":430,"y":60,"wires":[]},{"id":"ac211720.19c9a8","type":"ui_gauge","z":"c88d6057.281f6","name":"","group":"1e9b1326.5b8a7d","order":4,"width":"5","height":"5","gtype":"gage","title":"Habitaciones","label":"Grados","format":"{{value}}C","min":0,"max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":450,"y":120,"wires":[]},{"id":"cf159a2d.d9f248","type":"ui_gauge","z":"c88d6057.281f6","name":"","group":"1e9b1326.5b8a7d","order":5,"width":"5","height":"5","gtype":"gage","title":"Estudio","label":"Grados","format":"{{value}}C","min":0,"max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":440,"y":160,"wires":[]},{"id":"d317f27e.a4343","type":"inject","z":"c88d6057.281f6","name":"","topic":"","payload":"9","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":170,"y":100,"wires":[["70f0b3b2.72caac","ac211720.19c9a8","cf159a2d.d9f248"]]},{"id":"ccf9c342.04297","type":"file","z":"c88d6057.281f6","name":"guarda temperatura","filename":"resources/configuraciones/termostato.json","appendNewline":true,"createDir":false,"overwriteFile":"true","x":500,"y":720,"wires":[["4365e3cd.f93c2c"]]},{"id":"6434f219.38e3bc","type":"change","z":"c88d6057.281f6","name":"set on-off","rules":[{"t":"set","p":"termostato.OnOff","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":260,"wires":[["b2ed1fff.942bf"]]},{"id":"b1e03ff8.a8ff","type":"change","z":"c88d6057.281f6","name":"set temp dia","rules":[{"t":"set","p":"termostato.tempDia","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":360,"wires":[[]]},{"id":"7b86a000.09267","type":"change","z":"c88d6057.281f6","name":"set temp dia","rules":[{"t":"set","p":"termostato.tempNoche","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":540,"wires":[[]]}]